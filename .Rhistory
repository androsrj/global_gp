x <- seq(3, 21, by = 3)
y_trump <- rep(p_win_trump, 7)
plotCI(x, y_trump, ui = U_trump, li = L_trump,
add = T, xaxt = 'n', lwd = 2,
col = "brown3", xlab = "", ylab = "")
axis(1, at = seq(2.5, 20.5, by = 3),
labels = c("AZ", "GA", "MI", "NC", "NV", "PA", "WI"))
legend("topright", legend=c("Biden", "Trump"), fill = c("blue", "brown3"))
wpd <- rbind(U_biden - L_biden, U_trump - L_trump)
rownames(wpd) <- c("Biden", "Trump")
colnames(wpd) <- c("AZ", "GA", "MI", "NC", "NV", "PA", "WI")
wpd <- wpd[ , order(-colSums(wpd))]
par(mar=c(5, 6, 2, 2))
barplot(wpd,
col = c("dodgerblue", "brown3"),
legend = rownames(wpd),
xlab = "Forecast Scenario (2)",
ylab = "Win Probability Difference \n (WPD)",
yaxt = 'n',
cex.lab = 1.5,
beside = TRUE)
axis(2, at = seq(0, 0.6, by=0.1), labels = paste0(seq(0, 60, by=10), "%"), las=2)
## Condition on two states at once
# Biden
state_duos <- t(combn(states, 2))
biden_duo_probs <- sapply(1:nrow(state_duos), function(x) {
conditionalProbMulti(states = state_duos[x, ], win = TRUE, candidate = "Biden")
})
duo_biden <- data.frame(state1 = state_duos[,1],
state2 = state_duos[,2],
win_prob_biden = biden_duo_probs) %>%
arrange(-win_prob_biden)
duo_biden
par(mar=c(7, 7, 4, 2))
barplot(duo_biden$win_prob_biden,
xlab = "", ylab = "",
cex.main = 1.5,
ylim = c(0, 1),
yaxt = 'n',
main = "Biden",
col = terrain.colors(21))
abline(h = p_win_biden, lty = 2)
axis(2, at = seq(0, 1, by=0.2), labels = paste0(seq(0, 100, by=20), "%"), las = 2)
axis(1, at = seq(0.8, 24.75, length=21), labels = paste0(toupper(duo_biden$state1), ", ",
toupper(duo_biden$state2)), las = 2)
title(xlab = "Forecast Scenario (2)",
ylab = "Conditional Win Probability",
cex.lab = 1.4, line = 5)
# Trump
trump_duo_probs <- sapply(1:nrow(state_duos), function(x) {
conditionalProbMulti(states = state_duos[x, ], win = TRUE, candidate = "Trump")
})
duo_trump <- data.frame(state1 = state_duos[,1],
state2 = state_duos[,2],
win_prob_trump = trump_duo_probs) %>%
arrange(-win_prob_trump)
duo_trump
par(mar=c(7, 7, 4, 2))
barplot(duo_trump$win_prob_trump,
xlab = "", ylab = "",
cex.main = 1.5,
ylim = c(0, 1),
yaxt = 'n',
main = "Trump",
col = terrain.colors(21))
abline(h = p_win_trump, lty = 2)
axis(2, at = seq(0, 1, by=0.2), labels = paste0(seq(0, 100, by=20), "%"), las = 2)
axis(1, at = seq(0.8, 24.75, length=21), labels = paste0(toupper(duo_trump$state1), ", ",
toupper(duo_trump$state2)), las = 2)
title(xlab = "Forecast Scenario (2)",
ylab = "Conditional Win Probability",
cex.lab = 1.4, line = 5)
library(combinat)
library(tidyverse)
library(plotrix)
library(RColorBrewer)
conditionalProb <- function(state, win, candidate) {
opponent <- ifelse(candidate == "Trump", "Biden", "Trump")
if (win == FALSE) {
index <- outcomes[ , state] == opponent & winner == candidate
den <- state_probs[state, opponent]
} else {
index <- outcomes[ , state] == candidate & winner == candidate
den <- state_probs[state, candidate]
}
num <- sum(prob[index])
return(num/den)
}
conditionalProbMulti <- function(states, win, candidate) {
opponent <- ifelse(candidate == "Trump", "Biden", "Trump")
if (win == FALSE) {
index <- outcomes[ , states[1]] == opponent &
outcomes[ , states[2]] == opponent &
winner == candidate
den <- state_probs[states[1], opponent] * state_probs[states[2], opponent]
} else {
index <- outcomes[ , states[1]] == candidate  &
outcomes[ , states[2]] == candidate &
winner == candidate
den <- state_probs[states[1], candidate] * state_probs[states[2], candidate]
}
num <- sum(prob[index])
return(num/den)
}
az <- c(0.32, 0.68)
ga <- c(0.42, 0.58)
mi <- c(0.05, 0.95)
nc <- c(0.36, 0.64)
nv <- c(0.12, 0.88)
pa <- c(0.16, 0.84)
wi <- c(0.06, 0.94)
state_probs <- rbind(az, ga, mi, nc, nv, pa, wi)
colnames(state_probs) <- c("Trump", "Biden")
states <- c("az", "ga", "mi", "nc", "nv", "pa", "wi")
set.seed(324)
samples <- t(replicate(5000, sample(c("Trump", "Biden"), 7, replace = T)))
outcomes <- as.data.frame(samples) %>%
distinct() %>%
arrange(V1, V2, V3, V4, V5, V6)
colnames(outcomes) <- states
winner <- numeric(nrow(outcomes))
prob <- numeric(nrow(outcomes))
elec_votes <- c(11, 16, 15, 16, 6, 19, 10)
dem_starting <- 227
rep_starting <- 217
for (i in 1:nrow(outcomes)) {
#prob[i] <- .5^sum(outcomes[i,] == "Trump") * .5^sum(outcomes[i,] == "Biden")
prob[i] <- prod((outcomes[i, ] == "Trump") * state_probs[ , "Trump"] +
(outcomes[i, ] == "Biden") * state_probs[ , "Biden"])
dem_votes <- dem_starting + sum(elec_votes * (outcomes[i,] == "Biden"))
rep_votes <- rep_starting + sum(elec_votes * (outcomes[i,] == "Trump"))
if (dem_votes >= 270) {
winner[i] <- "Biden"
} else if (rep_votes >= 270) {
winner[i] <- "Trump"
} else {
winner[i] <- "Tie"
}
}
p_win_trump <- sum((winner == "Trump") * prob)
p_win_biden <- sum((winner == "Biden") * prob)
# Overall win probabilities
cat(paste0("Trump win probability: ", round(p_win_trump, 4), "\n"))
cat(paste0("Biden win probability: ", round(p_win_biden, 4), "\n"))
# Conditional win probabilities
# Condition on AZ
conditionalProb("az", TRUE, "Trump")
conditionalProb("az", FALSE, "Trump")
conditionalProb("az", TRUE, "Biden")
conditionalProb("az", FALSE, "Biden")
# Condition on GA
conditionalProb("ga", TRUE, "Trump")
conditionalProb("ga", FALSE, "Trump")
conditionalProb("ga", TRUE, "Biden")
conditionalProb("ga", FALSE, "Biden")
# Condition on MI
conditionalProb("mi", TRUE, "Trump")
conditionalProb("mi", FALSE, "Trump")
conditionalProb("mi", TRUE, "Biden")
conditionalProb("mi", FALSE, "Biden")
# Condition on NC
conditionalProb("nc", TRUE, "Trump")
conditionalProb("nc", FALSE, "Trump")
conditionalProb("nc", TRUE, "Biden")
conditionalProb("nc", FALSE, "Biden")
# Condition on NV
conditionalProb("nv", TRUE, "Trump")
conditionalProb("nv", FALSE, "Trump")
conditionalProb("nv", TRUE, "Biden")
conditionalProb("nv", FALSE, "Biden")
# Condition on PA
conditionalProb("pa", TRUE, "Trump")
conditionalProb("pa", FALSE, "Trump")
conditionalProb("pa", TRUE, "Biden")
conditionalProb("pa", FALSE, "Biden")
# Condition on WI
conditionalProb("wi", TRUE, "Trump")
conditionalProb("wi", FALSE, "Trump")
conditionalProb("wi", TRUE, "Biden")
conditionalProb("wi", FALSE, "Biden")
L_biden <- c(conditionalProb("az", FALSE, "Biden"),
conditionalProb("ga", FALSE, "Biden"),
conditionalProb("mi", FALSE, "Biden"),
conditionalProb("nc", FALSE, "Biden"),
conditionalProb("nv", FALSE, "Biden"),
conditionalProb("pa", FALSE, "Biden"),
conditionalProb("wi", FALSE, "Biden"))
U_biden <- c(conditionalProb("az", TRUE, "Biden"),
conditionalProb("ga", TRUE, "Biden"),
conditionalProb("mi", TRUE, "Biden"),
conditionalProb("nc", TRUE, "Biden"),
conditionalProb("nv", TRUE, "Biden"),
conditionalProb("pa", TRUE, "Biden"),
conditionalProb("wi", TRUE, "Biden"))
L_trump <- c(conditionalProb("az", FALSE, "Trump"),
conditionalProb("ga", FALSE, "Trump"),
conditionalProb("mi", FALSE, "Trump"),
conditionalProb("nc", FALSE, "Trump"),
conditionalProb("nv", FALSE, "Trump"),
conditionalProb("pa", FALSE, "Trump"),
conditionalProb("wi", FALSE, "Trump"))
U_trump <- c(conditionalProb("az", TRUE, "Trump"),
conditionalProb("ga", TRUE, "Trump"),
conditionalProb("mi", TRUE, "Trump"),
conditionalProb("nc", TRUE, "Trump"),
conditionalProb("nv", TRUE, "Trump"),
conditionalProb("pa", TRUE, "Trump"),
conditionalProb("wi", TRUE, "Trump"))
# WPD plots
par(mar=c(5, 5, 2, 2))
x <- seq(2, 20, by = 3)
y_biden <- rep(p_win_biden, 7)
plotCI(x, y_biden, ui = U_biden, li = L_biden,
xlim = c(1,22), ylim = c(0, 1),
col = "blue", xaxt = 'n', lwd =2 ,
xlab = "Forecast Scenario (2)",
ylab = "Win Probability",
cex.lab = 1.5)
abline(h = p_win_biden, lty = 2, col = "blue")
abline(h = p_win_trump, lty = 2, col = "brown3")
x <- seq(3, 21, by = 3)
y_trump <- rep(p_win_trump, 7)
plotCI(x, y_trump, ui = U_trump, li = L_trump,
add = T, xaxt = 'n', lwd = 2,
col = "brown3", xlab = "", ylab = "")
axis(1, at = seq(2.5, 20.5, by = 3),
labels = c("AZ", "GA", "MI", "NC", "NV", "PA", "WI"))
legend("topright", legend=c("Biden", "Trump"), fill = c("blue", "brown3"))
wpd <- rbind(U_biden - L_biden, U_trump - L_trump)
rownames(wpd) <- c("Biden", "Trump")
colnames(wpd) <- c("AZ", "GA", "MI", "NC", "NV", "PA", "WI")
wpd <- wpd[ , order(-colSums(wpd))]
par(mar=c(5, 6, 2, 2))
barplot(wpd,
col = c("dodgerblue", "brown3"),
legend = rownames(wpd),
xlab = "Forecast Scenario (2)",
ylab = "Win Probability Difference \n (WPD)",
yaxt = 'n',
cex.lab = 1.5,
beside = TRUE)
axis(2, at = seq(0, 0.6, by=0.1), labels = paste0(seq(0, 60, by=10), "%"), las=2)
## Condition on two states at once
# Biden
state_duos <- t(combn(states, 2))
biden_duo_probs <- sapply(1:nrow(state_duos), function(x) {
conditionalProbMulti(states = state_duos[x, ], win = TRUE, candidate = "Biden")
})
duo_biden <- data.frame(state1 = state_duos[,1],
state2 = state_duos[,2],
win_prob_biden = biden_duo_probs) %>%
arrange(-win_prob_biden)
duo_biden
par(mar=c(7, 7, 4, 2))
barplot(duo_biden$win_prob_biden,
xlab = "", ylab = "",
cex.main = 1.5,
ylim = c(0, 1),
yaxt = 'n',
main = "Biden",
col = terrain.colors(21))
abline(h = p_win_biden, lty = 2)
axis(2, at = seq(0, 1, by=0.2), labels = paste0(seq(0, 100, by=20), "%"), las = 2)
axis(1, at = seq(0.8, 24.75, length=21), labels = paste0(toupper(duo_biden$state1), ", ",
toupper(duo_biden$state2)), las = 2)
title(xlab = "Forecast Scenario (2)",
ylab = "Conditional Win Probability",
cex.lab = 1.4, line = 5)
# Trump
trump_duo_probs <- sapply(1:nrow(state_duos), function(x) {
conditionalProbMulti(states = state_duos[x, ], win = TRUE, candidate = "Trump")
})
duo_trump <- data.frame(state1 = state_duos[,1],
state2 = state_duos[,2],
win_prob_trump = trump_duo_probs) %>%
arrange(-win_prob_trump)
duo_trump
par(mar=c(7, 7, 4, 2))
barplot(duo_trump$win_prob_trump,
xlab = "", ylab = "",
cex.main = 1.5,
ylim = c(0, 1),
yaxt = 'n',
main = "Trump",
col = terrain.colors(21))
abline(h = p_win_trump, lty = 2)
axis(2, at = seq(0, 1, by=0.2), labels = paste0(seq(0, 100, by=20), "%"), las = 2)
axis(1, at = seq(0.8, 24.75, length=21), labels = paste0(toupper(duo_trump$state1), ", ",
toupper(duo_trump$state2)), las = 2)
title(xlab = "Forecast Scenario (2)",
ylab = "Conditional Win Probability",
cex.lab = 1.4, line = 5)
# Overall win probabilities
cat(paste0("Trump win probability: ", round(p_win_trump, 4), "\n"))
cat(paste0("Biden win probability: ", round(p_win_biden, 4), "\n"))
library(combinat)
library(tidyverse)
library(plotrix)
library(RColorBrewer)
conditionalProb <- function(state, win, candidate) {
opponent <- ifelse(candidate == "Trump", "Biden", "Trump")
if (win == FALSE) {
index <- outcomes[ , state] == opponent & winner == candidate
den <- state_probs[state, opponent]
} else {
index <- outcomes[ , state] == candidate & winner == candidate
den <- state_probs[state, candidate]
}
num <- sum(prob[index])
return(num/den)
}
conditionalProbMulti <- function(states, win, candidate) {
opponent <- ifelse(candidate == "Trump", "Biden", "Trump")
if (win == FALSE) {
index <- outcomes[ , states[1]] == opponent &
outcomes[ , states[2]] == opponent &
winner == candidate
den <- state_probs[states[1], opponent] * state_probs[states[2], opponent]
} else {
index <- outcomes[ , states[1]] == candidate  &
outcomes[ , states[2]] == candidate &
winner == candidate
den <- state_probs[states[1], candidate] * state_probs[states[2], candidate]
}
num <- sum(prob[index])
return(num/den)
}
az <- ga <- mi <- nc <- nv <- pa <- wi <- c(0.5, 0.5)
state_probs <- rbind(az, ga, mi, nc, nv, pa, wi)
colnames(state_probs) <- c("Trump", "Biden")
states <- c("az", "ga", "mi", "nc", "nv", "pa", "wi")
set.seed(324)
samples <- t(replicate(5000, sample(c("Trump", "Biden"), 7, replace = T)))
outcomes <- as.data.frame(samples) %>%
distinct() %>%
arrange(V1, V2, V3, V4, V5, V6)
colnames(outcomes) <- states
winner <- numeric(nrow(outcomes))
prob <- numeric(nrow(outcomes))
elec_votes <- c(11, 16, 15, 16, 6, 19, 10)
dem_starting <- 227
rep_starting <- 217
for (i in 1:nrow(outcomes)) {
#prob[i] <- .5^sum(outcomes[i,] == "Trump") * .5^sum(outcomes[i,] == "Biden")
prob[i] <- prod((outcomes[i, ] == "Trump") * state_probs[ , "Trump"] +
(outcomes[i, ] == "Biden") * state_probs[ , "Biden"])
dem_votes <- dem_starting + sum(elec_votes * (outcomes[i,] == "Biden"))
rep_votes <- rep_starting + sum(elec_votes * (outcomes[i,] == "Trump"))
if (dem_votes >= 270) {
winner[i] <- "Biden"
} else if (rep_votes >= 270) {
winner[i] <- "Trump"
} else {
winner[i] <- "Tie"
}
}
p_win_trump <- sum((winner == "Trump") * prob)
p_win_biden <- sum((winner == "Biden") * prob)
# Overall win probabilities
cat(paste0("Trump win probability: ", round(p_win_trump, 4), "\n"))
cat(paste0("Biden win probability: ", round(p_win_biden, 4), "\n"))
# Conditional win probabilities
# Condition on AZ
conditionalProb("az", TRUE, "Trump")
conditionalProb("az", FALSE, "Trump")
conditionalProb("az", TRUE, "Biden")
conditionalProb("az", FALSE, "Biden")
# Condition on GA
conditionalProb("ga", TRUE, "Trump")
conditionalProb("ga", FALSE, "Trump")
conditionalProb("ga", TRUE, "Biden")
conditionalProb("ga", FALSE, "Biden")
# Condition on MI
conditionalProb("mi", TRUE, "Trump")
conditionalProb("mi", FALSE, "Trump")
conditionalProb("mi", TRUE, "Biden")
conditionalProb("mi", FALSE, "Biden")
# Condition on NC
conditionalProb("nc", TRUE, "Trump")
conditionalProb("nc", FALSE, "Trump")
conditionalProb("nc", TRUE, "Biden")
conditionalProb("nc", FALSE, "Biden")
# Condition on NV
conditionalProb("nv", TRUE, "Trump")
conditionalProb("nv", FALSE, "Trump")
conditionalProb("nv", TRUE, "Biden")
conditionalProb("nv", FALSE, "Biden")
# Condition on PA
conditionalProb("pa", TRUE, "Trump")
conditionalProb("pa", FALSE, "Trump")
conditionalProb("pa", TRUE, "Biden")
conditionalProb("pa", FALSE, "Biden")
# Condition on WI
conditionalProb("wi", TRUE, "Trump")
conditionalProb("wi", FALSE, "Trump")
conditionalProb("wi", TRUE, "Biden")
conditionalProb("wi", FALSE, "Biden")
L_biden <- c(conditionalProb("az", FALSE, "Biden"),
conditionalProb("ga", FALSE, "Biden"),
conditionalProb("mi", FALSE, "Biden"),
conditionalProb("nc", FALSE, "Biden"),
conditionalProb("nv", FALSE, "Biden"),
conditionalProb("pa", FALSE, "Biden"),
conditionalProb("wi", FALSE, "Biden"))
U_biden <- c(conditionalProb("az", TRUE, "Biden"),
conditionalProb("ga", TRUE, "Biden"),
conditionalProb("mi", TRUE, "Biden"),
conditionalProb("nc", TRUE, "Biden"),
conditionalProb("nv", TRUE, "Biden"),
conditionalProb("pa", TRUE, "Biden"),
conditionalProb("wi", TRUE, "Biden"))
L_trump <- c(conditionalProb("az", FALSE, "Trump"),
conditionalProb("ga", FALSE, "Trump"),
conditionalProb("mi", FALSE, "Trump"),
conditionalProb("nc", FALSE, "Trump"),
conditionalProb("nv", FALSE, "Trump"),
conditionalProb("pa", FALSE, "Trump"),
conditionalProb("wi", FALSE, "Trump"))
U_trump <- c(conditionalProb("az", TRUE, "Trump"),
conditionalProb("ga", TRUE, "Trump"),
conditionalProb("mi", TRUE, "Trump"),
conditionalProb("nc", TRUE, "Trump"),
conditionalProb("nv", TRUE, "Trump"),
conditionalProb("pa", TRUE, "Trump"),
conditionalProb("wi", TRUE, "Trump"))
# WPD plots
par(mar=c(5, 5, 2, 2))
x <- seq(2, 20, by = 3)
y_biden <- rep(p_win_biden, 7)
plotCI(x, y_biden, ui = U_biden, li = L_biden,
xlim = c(1,22), ylim = c(0, 1),
col = "blue", xaxt = 'n', lwd =2 ,
xlab = "Forecast Scenario (2)",
ylab = "Win Probability",
cex.lab = 1.5)
abline(h = p_win_biden, lty = 2, col = "blue")
abline(h = p_win_trump, lty = 2, col = "brown3")
x <- seq(3, 21, by = 3)
y_trump <- rep(p_win_trump, 7)
plotCI(x, y_trump, ui = U_trump, li = L_trump,
add = T, xaxt = 'n', lwd = 2,
col = "brown3", xlab = "", ylab = "")
axis(1, at = seq(2.5, 20.5, by = 3),
labels = c("AZ", "GA", "MI", "NC", "NV", "PA", "WI"))
legend("topright", legend=c("Biden", "Trump"), fill = c("blue", "brown3"))
wpd <- rbind(U_biden - L_biden, U_trump - L_trump)
rownames(wpd) <- c("Biden", "Trump")
colnames(wpd) <- c("AZ", "GA", "MI", "NC", "NV", "PA", "WI")
wpd <- wpd[ , order(-colSums(wpd))]
par(mar=c(5, 6, 2, 2))
barplot(wpd,
col = c("dodgerblue", "brown3"),
legend = rownames(wpd),
xlab = "Forecast Scenario (2)",
ylab = "Win Probability Difference \n (WPD)",
yaxt = 'n',
cex.lab = 1.5,
beside = TRUE)
axis(2, at = seq(0, 0.6, by=0.1), labels = paste0(seq(0, 60, by=10), "%"), las=2)
## Condition on two states at once
# Biden
state_duos <- t(combn(states, 2))
biden_duo_probs <- sapply(1:nrow(state_duos), function(x) {
conditionalProbMulti(states = state_duos[x, ], win = TRUE, candidate = "Biden")
})
duo_biden <- data.frame(state1 = state_duos[,1],
state2 = state_duos[,2],
win_prob_biden = biden_duo_probs) %>%
arrange(-win_prob_biden)
duo_biden
par(mar=c(7, 7, 4, 2))
barplot(duo_biden$win_prob_biden,
xlab = "", ylab = "",
cex.main = 1.5,
ylim = c(0, 1),
yaxt = 'n',
main = "Biden",
col = terrain.colors(21))
abline(h = p_win_biden, lty = 2)
axis(2, at = seq(0, 1, by=0.2), labels = paste0(seq(0, 100, by=20), "%"), las = 2)
axis(1, at = seq(0.8, 24.75, length=21), labels = paste0(toupper(duo_biden$state1), ", ",
toupper(duo_biden$state2)), las = 2)
title(xlab = "Forecast Scenario (2)",
ylab = "Conditional Win Probability",
cex.lab = 1.4, line = 5)
# Trump
trump_duo_probs <- sapply(1:nrow(state_duos), function(x) {
conditionalProbMulti(states = state_duos[x, ], win = TRUE, candidate = "Trump")
})
duo_trump <- data.frame(state1 = state_duos[,1],
state2 = state_duos[,2],
win_prob_trump = trump_duo_probs) %>%
arrange(-win_prob_trump)
duo_trump
par(mar=c(7, 7, 4, 2))
barplot(duo_trump$win_prob_trump,
xlab = "", ylab = "",
cex.main = 1.5,
ylim = c(0, 1),
yaxt = 'n',
main = "Trump",
col = terrain.colors(21))
abline(h = p_win_trump, lty = 2)
axis(2, at = seq(0, 1, by=0.2), labels = paste0(seq(0, 100, by=20), "%"), las = 2)
axis(1, at = seq(0.8, 24.75, length=21), labels = paste0(toupper(duo_trump$state1), ", ",
toupper(duo_trump$state2)), las = 2)
title(xlab = "Forecast Scenario (2)",
ylab = "Conditional Win Probability",
cex.lab = 1.4, line = 5)
# Overall win probabilities
cat(paste0("Trump win probability: ", round(p_win_trump, 4), "\n"))
cat(paste0("Biden win probability: ", round(p_win_biden, 4), "\n"))
